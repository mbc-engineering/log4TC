<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Graylog Ausgabe-Plugin | Dokumentation mbc Log4Tc </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Graylog Ausgabe-Plugin | Dokumentation mbc Log4Tc ">
      
      
      <link rel="icon" href="../favicon.ico">
      <link rel="stylesheet" href="../public/docfx.min.css">
      <link rel="stylesheet" href="../public/main.css">
      <meta name="docfx:navrel" content="../toc.html">
      <meta name="docfx:tocrel" content="toc.html">
      
      <meta name="docfx:rel" content="../">
      
      
      
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../index.html">
            <img id="logo" class="svg" src="../logo.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="graylog-ausgabe-plugin">Graylog Ausgabe-Plugin</h1>

<p>Graylog ist ein Log-Managementsystem, das zentrall Log-Meldungen entgegennimmt, speichert und zur Echtzeitanalyse bereitstellt. Graylog benutzt intern Elasticsearch und lässt sich horizontal skalieren, aber auch nur auf einem einzelnen Rechner installieren. Graylog kann als Open Source oder als Enterprise Version eingesetzt werden.</p>
<p>Log4TC wird standardmässig mit dem Graylog Ausgabe-Plugin ausgeliefert. Details zur Graylog können auf <a href="https://docs.graylog.org/">https://docs.graylog.org/</a> nachgelesen werden.</p>
<h2 id="konfiguration-in-log4tc">Konfiguration in log4TC</h2>
<p>Um Meldungen an Graylog ausgeben zu können, muss der log4TC-Service zuerst konfiguriert werden. Eine einfache Konfiguration (<code>%ProgramData%\log4TC\config\appsettings.json</code>) sieht wie folgt aus:</p>
<pre><code class="lang-json">{
  {
  &quot;Logging&quot;: {
    &quot;LogLevel&quot;: {
      &quot;Default&quot;: &quot;Information&quot;,
      &quot;Microsoft&quot;: &quot;Warning&quot;,
      &quot;Microsoft.Hosting.Lifetime&quot;: &quot;Information&quot;
    }
  },
  {
    &quot;Outputs&quot;: [
      {
        &quot;Type&quot;: &quot;graylog&quot;,
        &quot;Config&quot;: {
          &quot;GraylogHostname&quot;: &quot;localhost&quot;
        }
      }
    ]
  }
}
</code></pre>
<p>Die wesentliche Konfiguration der Graylogausgabe befindet sich in der <code>Outputs</code>-Liste.</p>
<pre><code class="lang-json">{
    &quot;Type&quot;: &quot;graylog&quot;,
    &quot;Config&quot;: {
        &quot;GraylogHostname&quot;: &quot;localhost&quot;, # Hostname oder IP, optional, Default &quot;localhost&quot;
        &quot;GraylogPort&quot;: 12201,           # UDP-Port auf Graylog-Server, optional, Default 12201
        &quot;GelfCompression&quot;: &quot;Gzip&quot;,      # GELF-Kompression, optional, Default gzip. Alternativen: &quot;None&quot;
    }
}
</code></pre>
<p>Log4TC kommuniziert mit dem Graylog-Server über Gelf-UDP, daher muss auf dem Server ein enstprechender Input konfiguriert werden, was häufig schon der Fall ist.</p>
<p>Graylog kann nativ installiert werden, wir empfehlen aber den Betrieb über Docker, zumindest wenn Graylog abseits der TwinCAT-Runtime installiert werden kann (Docker läuft nicht zusammen mit der TwinCAT-Runtime bzw. umgekehrt).</p>
<div class="NOTE">
<h5>Note</h5>
<p>Ein Beispiel Docker-Compose befindet sich auf Github im Graylog-Beispielordner <a href="https://github.com/mbc-engineering/log4TC/blob/master/source/TwinCat_Examples/graylog/docker-compose.yml">https://github.com/mbc-engineering/log4TC/blob/master/source/TwinCat_Examples/graylog/docker-compose.yml</a>.</p>
</div>
<h2 id="log4tc-log-meldungen-in-graylog">log4TC Log-Meldungen in Graylog</h2>
<p>Log4TC versucht bei der Ausgabe in Graylog alle strukturierten Elemente zu erhalten. Eine Graylog-Meldung hat folgende Felder:</p>
<ul>
<li><strong><code>appName</code></strong> - Der Name der TwinCAT Application (z.B. <code>Port_851</code>)</li>
<li><strong><code>clockTimestamp</code></strong> - Der Zeitstempel der Windowsuhr (geringe Genaugikeit)</li>
<li><strong><code>fullMessage</code></strong> - Die Log-Meldung ohne Variablenersetzung. Kann für Suche und Selektion verwendet werden um gleichartige Meldungen zu selektieren.</li>
<li><strong><code>level</code></strong> - Der Log-Level als Syslog-Wert. Graylog kann diesen Wert mit Decorators in Text umwandeln</li>
<li><strong><code>logger</code></strong> - Der Loggername der Log-Meldung.</li>
<li><strong><code>message</code></strong> - Die Log-Meldung mit Variablenersetzungen.</li>
<li><strong><code>onlineChangeCount</code></strong> - Anzahl der Online-Changes</li>
<li><strong><code>projectName</code></strong> - Der Name des SPS-Projekts.</li>
<li><strong><code>source</code></strong> - Die Ads-Net-Id von der die Log-Message empfangen wurde.</li>
<li><strong><code>hostname</code></strong> - Der Hostname von dem die Log-Message empfangen wurde.</li>
<li><strong><code>taskCycleCounter</code></strong> - Der Wert des Task-Zykluszähler (alle Meldungen vom gleichen Zyklus haben den gleichen Wert)</li>
<li><strong><code>taskIndex</code></strong> - Der TwinCAT Task-Index (1-x)</li>
<li><strong><code>taskName</code></strong> - Der Name der TwinCAT Application</li>
<li><strong><code>timestamp</code></strong> - Der PLC-Zeitstempel (hone Genauigkeit)</li>
</ul>

</article>

        <div class="contribution d-print-none">
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <div style="display: flex; align-items: center; gap: 20px;"> <div id="google_translate_element"></div> <script type="text/javascript">  function googleTranslateElementInit() {    new google.translate.TranslateElement({      pageLanguage: 'de',       includedLanguages: 'en,de,fr,es',      layout: google.translate.TranslateElement.InlineLayout.SIMPLE    }, 'google_translate_element');  }</script><script type="text/javascript" src="https://translate.google.com/translate_a/element.js?hl=en&cb=googleTranslateElementInit"></script>   <div><span>Help us on <a href="https://github.com/mbc-engineering/log4TC"><strong>github</strong></a></span></div> </div>
        </div>
      </div>
    </footer>
  </body>
</html>
