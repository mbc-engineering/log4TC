<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Graylog Ausgabe-Plugin | Dokumentation mbc Log4Tc </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Graylog Ausgabe-Plugin | Dokumentation mbc Log4Tc ">
    <meta name="generator" content="docfx 2.52.0.0">
    
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet"> 
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    <meta property="docfx:rel" content="../">
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-127632729-2"></script>
  </head>  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="graylog-ausgabe-plugin">Graylog Ausgabe-Plugin</h1>

<p>Graylog ist ein Log-Managementsystem, das zentrall Log-Meldungen entgegennimmt, speichert und zur Echtzeitanalyse bereitstellt. Graylog benutzt intern Elasticsearch und lässt sich horizontal skalieren, aber auch nur auf einem einzelnen Rechner installieren. Graylog kann als Open Source oder als Enterprise Version eingesetzt werden.</p>
<p>Log4TC wird standardmässig mit dem Graylog Ausgabe-Plugin ausgeliefert. Details zur Graylog können auf <a href="https://docs.graylog.org/">https://docs.graylog.org/</a> nachgelesen werden.</p>
<h2 id="konfiguration-in-log4tc">Konfiguration in log4TC</h2>
<p>Um Meldungen an Graylog ausgeben zu können, muss der log4TC-Service zuerst konfiguriert werden. Eine einfache Konfiguration (<code>%ProgramData%\log4TC\confg\appsettings.json</code>) sieht wie folgt aus:</p>
<pre><code class="lang-json">{
  &quot;Logging&quot;: {
    &quot;LogLevel&quot;: {
      &quot;Default&quot;: &quot;Information&quot;,
      &quot;Microsoft&quot;: &quot;Warning&quot;,
      &quot;Microsoft.Hosting.Lifetime&quot;: &quot;Information&quot;
    }
  },
  &quot;Outputs&quot;: [
    {
      &quot;Type&quot;: &quot;graylog&quot;,
      &quot;Config&quot;: {
        &quot;GraylogHostname&quot;: &quot;localhost&quot;
      }
    }
  ]
}
</code></pre>
<p>Die wesentliche Konfiguration der Graylogausgabe befindet sich in der <code>Outputs</code>-Liste.</p>
<pre><code class="lang-json">{
    &quot;Type&quot;: &quot;graylog&quot;,
    &quot;Config&quot;: {
        &quot;GraylogHostname&quot;: &quot;localhost&quot;, # Hostname oder IP, optional, Default &quot;localhost&quot;
        &quot;GraylogPort&quot;: 12201,           # UDP-Port auf Graylog-Server, optional, Default 12201
        &quot;GelfCompression&quot;: &quot;Gzip&quot;,      # GELF-Kompression, optional, Default gzip. Alternativen: &quot;None&quot;
    }
}
</code></pre>
<p>Log4TC kommuniziert mit dem Graylog-Server über Gelf-UDP, daher muss auf dem Server ein enstprechender Input konfiguriert werden, was häufig schon der Fall ist.</p>
<p>Graylog kann nativ installiert werden, wir empfehlen aber den Betrieb über Docker, zumindest wenn Graylog abseits der TwinCAT-Runtime installiert werden kann (Docker läuft nicht zusammen mit der TwinCAT-Runtime bzw. umgekehrt). Ein Beispiel Docker-Compose befindet sich auf Github im Graylog-Beispielordner <a href="https://github.com/mbc-engineering/log4TC/blob/master/graylog/docker-compose.yml">https://github.com/mbc-engineering/log4TC/blob/master/graylog/docker-compose.yml</a>.</p>
<h2 id="log4tc-log-meldungen-in-graylog">log4TC Log-Meldungen in Graylog</h2>
<p>Log4TC versucht bei der Ausgabe in Graylog alle strukturierten Elemente zu erhalten. Eine Graylog-Meldung hat folgende Felder:</p>
<ul>
<li><strong><code>appName</code></strong> - Der Name der TwinCAT Application (z.B. <code>Port_851</code>)</li>
<li><strong><code>clockTimestamp</code></strong> - Der Zeitstempel der Windowsuhr (geringe Genaugikeit)</li>
<li><strong><code>fullMessage</code></strong> - Die Log-Meldung ohne Variablenersetzung. Kann für Suche und Selektion verwendet werden um gleichartige Meldungen zu selektieren.</li>
<li><strong><code>level</code></strong> - Der Log-Level als Syslog-Wert. Graylog kann diesen Wert mit Decorators in Text umwandeln</li>
<li><strong><code>logger</code></strong> - Der Loggername der Log-Meldung.</li>
<li><strong><code>message</code></strong> - Die Log-Meldung mit Variablenersetzungen.</li>
<li><strong><code>onlineChangeCount</code></strong> - Anzahl der Online-Changes</li>
<li><strong><code>projectName</code></strong> - Der Name des SPS-Projekts.</li>
<li><strong><code>source</code></strong> - Die Ads-Net-Id von der die Log-Message empfangen wurde.</li>
<li><strong><code>hostname</code></strong> - Der Hostname von dem die Log-Message empfangen wurde.</li>
<li><strong><code>taskCycleCounter</code></strong> - Der Wert des Task-Zykluszähler (alle Meldungen vom gleichen Zyklus haben den gleichen Wert)</li>
<li><strong><code>taskIndex</code></strong> - Der TwinCAT Task-Index (1-x)</li>
<li><strong><code>taskName</code></strong> - Der Name der TwinCAT Application</li>
<li><strong><code>timestamp</code></strong> - Der PLC-Zeitstempel (hone Genauigkeit)</li>
</ul>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span>Copyright © 2020 <br><strong>mbc</strong>-engineering GmbH</span>
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>
